define(["wdn","ready","dropdown-widget","require"],function(e,t,n,r){"use strict";var i=function(e){return document.querySelector("link[rel="+e+"]")},d=function(){var t=i("login"),n=i("logout");return t&&e.setPluginParam("idm","login",t.getAttribute("href")),n&&e.setPluginParam("idm","logout",n.getAttribute("href")),e.getPluginParam("idm")||{}},o=encodeURIComponent(window.location),s="https://shib.unl.edu/idp/profile/cas/logout?url="+o,a="https://shib.unl.edu/idp/profile/cas/login?service="+o,u=!1,c=!1,l=function(e){return!(!u||!u[e])&&u[e][0]},m=function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET","https://directory.unl.edu/people/"+e+".json"),r.send(null),r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status?t(JSON.parse(r.responseText)):404===r.status?t({}):n(Error(r.status)))}})},f=function(e){return new Promise(function(t,n){var r=!!(e&&"unlHROrgUnitNumber"in e&&e.unlHROrgUnitNumber&&e.unlHROrgUnitNumber.length>0)&&e.unlHROrgUnitNumber[0];if(r){var i=new XMLHttpRequest;i.open("GET","https://directory.unl.edu/departments/"+r+"?format=json"),i.send(null),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?(e.department=JSON.parse(i.responseText),t(e)):t(e))}}else t(e)})},g=function(e,t,n){return new Promise(function(t,n){t(m(e))}).then(function(e){return new Promise(function(n,r){t&&!0===t.department&&(e=f(e)),n(e)}).then(function(e){n(h.formatUser(e))})})},p=function(e,t,n){return new Promise(function(n,r){t&&!0===t.department&&(e=f(e)),n(e)}).then(function(e){n(h.formatUser(e))})},h={initialize:function(n){var i=function(){t(function(){var e=d();e.login&&h.setLoginURL(e.login),h.renderAsLoggedOut()}),n&&n()},o=e.getCookie("unl_sso");o?r(["https://whoami.unl.edu/?id="+o],function(){e.idm.user&&(h.setSessionUser(e.idm.user),delete e.idm.user),h.isLoggedIn()?(n&&n(),t(function(){h.renderAsLoggedIn()})):(h.logout(),i())}):i()},setSessionUser:function(e){c=e,u=e},setUser:function(e){u=e},formatUser:function(e){var t={};return h.setUser(e),u&&(t.unlID=h.getUserId(),t.firstName=h.getFirstName(),t.lastName=h.getLastName(),t.fullName=l("displayName"),t.displayName=h.getDisplayName(),t.emailAddress=h.getEmailAddress(),t.postalAddress=h.getPostalAddress(),t.phoneNumber=h.getTelephoneNumber(),t.title=h.getTitle(),t.orgUnitNumber=h.getPrimaryHROrgUnitNumber(),t.orgUnitName=l("unlHRPrimaryDepartment"),t.primaryAffiliation=h.getPrimaryAffiliation(),t.avatar=u.imageURL,t.profileUrl=h.getProfileURL(),"department"in e&&(t.department=e.department)),h.setUser(!1),t},getSessionUser:function(){return c},getSessionUserExtras:function(e,t){p(c,e,t)},getUser:function(e,t,n){g(e,t,n)},logout:function(){e.setCookie("unl_sso","0",-1),u=!1},isLoggedIn:function(){return!!c&&c&&c.uid},getUserId:function(){return u&&u.uid},getDisplayName:function(){var e="";return u.eduPersonNickname?e=u.eduPersonNickname[0]:u.givenName?e=u.givenName[0]:u.displayName&&(e=u.displayName[0]),e},getFirstName:function(){return l("givenName")},getLastName:function(){return l("sn")},getPrimaryAffiliation:function(){return l("eduPersonPrimaryAffiliation")},getEmailAddress:function(){return l("mail")},getPostalAddress:function(){return l("postalAddress")},getTelephoneNumber:function(){return l("telephoneNumber")},getTitle:function(){return l("title")},getPrimaryHROrgUnitNumber:function(){return l("unlHROrgUnitNumber")},getProfileURL:function(){if(!this.isLoggedIn())return!1;var e=this.getUserId(),t="unl_";return"s-"===e.substring(2,0)?t+=e.replace("-","_"):t+=e,"https://planetred.unl.edu/pg/profile/"+t},renderAsLoggedIn:function(){for(var e=this,t=document.querySelectorAll(".dcf-idm"),r=d(),i=0;i<t.length;i++)!function(i){var d=document.createElement("BUTTON");d.classList.add("dcf-idm-login","dcf-d-flex","dcf-ai-center","dcf-jc-center","dcf-relative","dcf-h-100%","dcf-w-100%","dcf-p-0","dcf-b-0","dcf-bg-transparent","unl-scarlet"),d.setAttribute("aria-haspopup","true"),d.setAttribute("aria-expanded","false"),d.setAttribute("aria-controls","dcf-idm-options-"+i),d.setAttribute("aria-label","Account actions for "+e.getDisplayName());var o=document.createElement("IMG");o.classList.add("dcf-idm-img","dcf-txt-sm","dcf-h-6","dcf-w-6","dcf-circle","unl-bg-cream"),o.setAttribute("src","https://directory.unl.edu/avatar/"+e.getUserId()),o.setAttribute("alt",""),d.appendChild(o);var a=document.createElement("SPAN");a.classList.add("dcf-idm-label","dcf-txt-2xs","dcf-truncate"),a.innerText=e.getDisplayName(),d.appendChild(a);var u=document.createElement("DIV");u.classList.add("dcf-idm-options","dcf-absolute","dcf-p-6","dcf-txt-2xs","dcf-z-1","dcf-bg-overlay-dark"),u.setAttribute("id","dcf-idm-options-"+i),u.hidden=!0;var c=document.createElement("UL");c.classList.add("dcf-list-bare","dcf-mb-0");var l=document.createElement("LI"),m=document.createElement("A");m.classList.add("unl-cream"),m.setAttribute("href",e.getProfileURL()),m.innerText="View Profile",l.appendChild(m),c.appendChild(l);var f=document.createElement("LI"),g=document.createElement("A");g.classList.add("unl-cream"),g.setAttribute("href",s),g.innerText="Logout",f.appendChild(g),c.appendChild(f),u.appendChild(c);var p=t[i].querySelector(".dcf-idm-status-logged-out"),v=t[i].querySelector(".dcf-idm-status-logged-in");v.innerHTML="",v.appendChild(d),v.appendChild(u);var L=(new n(v,"idm-logged-in"),new CustomEvent("closeNavigation")),N=new CustomEvent("closeSearch");document.addEventListener("openDropDownWidget",function(e){"idm-logged-in"==e.detail.type&&(document.dispatchEvent(L),document.dispatchEvent(N))}),p.hidden=!0,v.hidden=!1,g.removeEventListener("click",h.logout),g.addEventListener("click",h.logout),h.setLogoutURL(r.logout),g.setAttribute("href",s)}(i);window.dispatchEvent(new Event("idmStateSet"))},renderAsLoggedOut:function(){if(!h.isLoggedIn()){for(var e=document.querySelectorAll(".dcf-idm"),t=0;t<e.length;t++){var n=e[t].querySelector(".dcf-idm-status-logged-out"),r=e[t].querySelector(".dcf-idm-status-logged-in");n.querySelector("a").setAttribute("href",a),r.hidden=!0,n.hidden=!1}window.dispatchEvent(new Event("idmStateSet"))}},setLogoutURL:function(e){e&&(s=e)},setLoginURL:function(e){e&&(a=e)}};return e.idm={},h});
//# sourceMappingURL=idm.js.map