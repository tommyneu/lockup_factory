define(["wdn","ready","dropdown-widget","require"],function(e,t,n,r){"use strict";var i=function(e){return document.querySelector("link[rel="+e+"]")},d=function(){var t=i("login"),n=i("logout");return t&&e.setPluginParam("idm","login",t.getAttribute("href")),n&&e.setPluginParam("idm","logout",n.getAttribute("href")),e.getPluginParam("idm")||{}},o=encodeURIComponent(window.location),s="https://shib.unl.edu/idp/profile/cas/logout?url="+o,a="https://shib.unl.edu/idp/profile/cas/login?service="+o,u=!1,l=!1,c=function(e){return!(!u||!u[e])&&u[e][0]},m={initialize:function(n){var i=function(){t(function(){var e=d();e.login&&m.setLoginURL(e.login),m.renderAsLoggedOut()}),n&&n()},o=e.getCookie("unl_sso");o?r(["https://whoami.unl.edu/?id="+o],function(){e.idm.user&&(m.setSessionUser(e.idm.user),delete e.idm.user),m.isLoggedIn()?(n&&n(),t(function(){m.renderAsLoggedIn()})):(m.logout(),i())}):i()},setSessionUser:function(e){l=e,u=e},setUser:function(e){u=e},formatUser:function(e,t){var n={};return m.setUser(e),u&&(n.unlID=m.getUserId(),n.firstName=m.getFirstName(),n.lastName=m.getLastName(),n.fullName=c("displayName"),n.displayName=m.getDisplayName(),n.emailAddress=m.getEmailAddress(),n.postalAddress=m.getPostalAddress(),n.phoneNumber=m.getTelephoneNumber(),n.title=m.getTitle(),n.orgUnitNumber=m.getPrimaryHROrgUnitNumber(),n.orgUnitName=c("unlHRPrimaryDepartment"),n.primaryAffiliation=m.getPrimaryAffiliation(),n.avatar=u.imageURL,n.profileUrl=m.getProfileURL(),t&&!0===t.department&&(n.department=m.getDepartment(n.orgUnitNumber))),m.setUser(!1),n},getSessionUser:function(e){return m.formatUser(l,e)},getUser:function(e,t){var n=!1,r=new XMLHttpRequest;return r.open("GET","https://directory.unl.edu/people/"+e+".json",!1),r.send(null),200===r.status&&(n=JSON.parse(r.responseText)),m.formatUser(n,t)},getDepartment:function(e){if(!e)return{};var t=new XMLHttpRequest;return t.open("GET","https://directory.unl.edu/departments/"+e+"?format=json",!1),t.send(null),200===t.status?JSON.parse(t.responseText):void 0},logout:function(){e.setCookie("unl_sso","0",-1),u=!1},isLoggedIn:function(){return!!l&&l&&l.uid},getUserId:function(){return u&&u.uid},getDisplayName:function(){var e="";return u.eduPersonNickname?e=u.eduPersonNickname[0]:u.givenName?e=u.givenName[0]:u.displayName&&(e=u.displayName[0]),e},getFirstName:function(){return c("givenName")},getLastName:function(){return c("sn")},getPrimaryAffiliation:function(){return c("eduPersonPrimaryAffiliation")},getEmailAddress:function(){return c("mail")},getPostalAddress:function(){return c("postalAddress")},getTelephoneNumber:function(){return c("telephoneNumber")},getTitle:function(){return c("title")},getPrimaryHROrgUnitNumber:function(){return c("unlHROrgUnitNumber")},getProfileURL:function(){if(!this.isLoggedIn())return!1;var e=this.getUserId(),t="unl_";return"s-"===e.substring(2,0)?t+=e.replace("-","_"):t+=e,"https://planetred.unl.edu/pg/profile/"+t},renderAsLoggedIn:function(){for(var e=this,t=document.querySelectorAll(".dcf-idm"),r=d(),i=0;i<t.length;i++)!function(i){var d=document.createElement("BUTTON");d.classList.add("dcf-idm-login","dcf-d-flex","dcf-ai-center","dcf-jc-center","dcf-relative","dcf-h-100%","dcf-w-100%","dcf-p-0","dcf-b-0","dcf-bg-transparent","unl-font-sans","unl-scarlet"),d.setAttribute("id","dcf-idm-toggle"),d.setAttribute("aria-haspopup","true"),d.setAttribute("aria-expanded","false"),d.setAttribute("aria-controls","dcf-idm-options-"+i),d.setAttribute("aria-label","Account actions for "+e.getDisplayName());var o=document.createElement("IMG");o.classList.add("dcf-idm-img","dcf-txt-sm","dcf-h-6","dcf-w-6","dcf-circle","unl-bg-cream"),o.setAttribute("src","https://directory.unl.edu/avatar/"+e.getUserId()),o.setAttribute("alt",""),d.appendChild(o);var a=document.createElement("SPAN");a.classList.add("dcf-idm-label","dcf-txt-2xs","dcf-truncate"),a.innerText=e.getDisplayName(),d.appendChild(a);var u=document.createElement("DIV");u.classList.add("dcf-idm-options","dcf-absolute","dcf-pt-6","dcf-pr-5","dcf-pb-5","dcf-pl-5","dcf-z-1","dcf-bg-overlay-dark"),u.setAttribute("id","dcf-idm-options-"+i),u.hidden=!0;var l=document.createElement("UL");l.classList.add("dcf-list-bare","dcf-mb-0","dcf-txt-2xs","unl-font-sans");var c=document.createElement("LI"),f=document.createElement("A");f.classList.add("unl-cream"),f.setAttribute("href",e.getProfileURL()),f.innerText="View Profile",c.appendChild(f),l.appendChild(c);var g=document.createElement("LI"),p=document.createElement("A");p.classList.add("unl-cream"),p.setAttribute("href",s),p.innerText="Logout",g.appendChild(p),l.appendChild(g),u.appendChild(l);var h=t[i].querySelector(".dcf-idm-status-logged-out"),v=t[i].querySelector(".dcf-idm-status-logged-in");v.innerHTML="",v.appendChild(d),v.appendChild(u);var L=(new n(v,"idm-logged-in"),new CustomEvent("closeNavigation")),b=new CustomEvent("closeSearch");document.addEventListener("openDropDownWidget",function(e){"idm-logged-in"==e.detail.type&&(document.dispatchEvent(L),document.dispatchEvent(b))}),h.hidden=!0,v.hidden=!1,p.removeEventListener("click",m.logout),p.addEventListener("click",m.logout),m.setLogoutURL(r.logout),p.setAttribute("href",s)}(i);window.dispatchEvent(new Event("idmStateSet"))},renderAsLoggedOut:function(){if(!m.isLoggedIn()){for(var e=document.querySelectorAll(".dcf-idm"),t=0;t<e.length;t++){var n=e[t].querySelector(".dcf-idm-status-logged-out"),r=e[t].querySelector(".dcf-idm-status-logged-in");n.querySelector("a").setAttribute("href",a),r.hidden=!0,n.hidden=!1}window.dispatchEvent(new Event("idmStateSet"))}},setLogoutURL:function(e){e&&(s=e)},setLoginURL:function(e){e&&(a=e)}};return e.idm={},m});
//# sourceMappingURL=idm.js.map